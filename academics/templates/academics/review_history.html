{% extends "base.html" %}

{% block content %}

<style>
/* layout fixes to avoid overlapping buttons and clipped titles */
.table td, .table th {
    vertical-align: middle !important;
    padding-top: 10px;
    padding-bottom: 10px;
}

/* Clip long course titles instead of wrapping into layout */
.text-clip {
    display: block;
    max-width: 520px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* small dividing line */
.small-divider {
    border: 0;
    border-top: 1px solid #e9e9e9;
    margin: 0.45rem 0;
}

/* Flexible action button container that wraps cleanly */
.action-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

/* smaller buttons, consistent look */
.btn-compact {
    padding: .35rem .6rem;
    font-size: .85rem;
}

/* section titles */
.section-title {
    font-size: 1.15rem;
    font-weight: 600;
    margin-top: 25px;
    margin-bottom: 8px;
}

/* Add spacing between Generated and PDF columns */
.generated-col {
    padding-right: 20px;
}

/* keep layout responsive */
@media (max-width: 768px) {
    .text-clip { max-width: 240px; }
}

/* ---- Button styles to match add_college_level_course ---- */
.btn {
    padding: 10px 14px;
    border-radius: 6px;
    border: 0;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
}
.btn-view    { background: #f5f7fa; color: #0a3b66; border: 1px solid #d6e0ef; }
.btn-download{ background: #6c757d; color: #fff; }
.btn-edit    { background: #1e88e5; color: #fff; }
.btn-delete  { background: #d32f2f; color: #fff; }
.btn-restore { background: #388e3c; color: #fff; }
.btn-light   { background: #ffffff; color: #333; border: 1px solid #ddd; }
.btn-generate{ background: #9d2330; color: #fff; }

/* keep .btn-compact for small buttons */
.btn.btn-compact { padding: .35rem .6rem; font-size:.85rem; }

/* spacing for anchors */
.action-buttons a { line-height: 1; }

.link-action {
  color: #0a3b66;
  text-decoration: none;
  border-bottom: 1px solid rgba(10,59,102,0.12);
  padding-bottom: 2px;
  margin: 0 6px;
  font-weight: 600;
  font-size: 0.95rem;
}
.link-action:hover {
  border-bottom-color: currentColor;
  color: #092b50;
  text-decoration: none;
}
.separator { color: #999; margin: 0 6px; }

.recycle-bin-warning {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 6px;
  padding: 12px 16px;
  margin-bottom: 20px;
  color: #856404;
  font-weight: 500;
}
</style>

<div class="container" style="max-width:1100px;margin:30px auto;">
  <h2 class="mb-4">History / Records (Dean)</h2>

  <p class="mb-4">
    <a class="btn btn-sm btn-outline-primary" href="{% url 'academics:review_history' %}?deleted=0">Active</a>
    <a class="btn btn-sm btn-outline-danger ms-2" href="{% url 'academics:review_history' %}?deleted=1">Recycle Bin</a>
  </p>

  {% if show_deleted %}
    <div class="recycle-bin-warning">
      ⚠️ <strong>Recycle Bin:</strong> Items in the recycle bin will be automatically and permanently deleted after 30 days. Restore important items to Active before expiry.
    </div>
  {% endif %}

  <!-- ========== COLLEGE LEVEL COURSES ========== -->
  <h3>College Level Courses {% if not show_deleted %}(Active){% else %}(Recycle Bin){% endif %}</h3>
  <table style="width:100%;border-collapse:collapse;">
    <thead>
      <tr style="background:#f4f6f8;">
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Code</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Title</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Category</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Semester</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:center;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for course in courses %}
        <tr>
          <td style="border:1px solid #ddd;padding:10px;">{{ course.course_code }}</td>
          <td style="border:1px solid #ddd;padding:10px;">{{ course.course_title }}</td>
          <td style="border:1px solid #ddd;padding:10px;">{{ course.course_category }}</td>
          <td style="border:1px solid #ddd;padding:10px;">{{ course.display_semester|default:"-" }}</td>
          <td style="border:1px solid #ddd;padding:10px;text-align:center;">
            {% if not show_deleted %}
              <a class="link-action" href="{% url 'academics:view_course_pdf' course.pk %}">View</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:download_course_pdf' course.pk %}">Download</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:edit_college_level_course' course.pk %}">Edit</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:delete_course_pdf' course.pk %}" onclick="return confirm('Move to recycle bin?');">Delete</a>
            {% else %}
              <a class="link-action" href="{% url 'academics:restore_course_pdf' course.pk %}">Restore</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:permanent_delete_course_pdf' course.pk %}" onclick="return confirm('Permanently delete?');">Delete Permanently</a>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="5" style="text-align:center;padding:20px;">No courses found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- ========== SEMESTER CREDITS (cleaned layout like Courses) ========== -->
  <h3>Semester Credits {% if not show_deleted %}(Active){% else %}(Recycle Bin){% endif %}</h3>
  <table style="width:100%;border-collapse:collapse;margin-bottom:20px;">
    <thead>
      <tr style="background:#f4f6f8;">
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Branch</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Admission Year</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:center;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for sc in credits %}
        <tr>
          <td style="border:1px solid #ddd;padding:10px;">{% if sc.branch %}{{ sc.branch.code }} — {{ sc.branch.name }}{% else %}<span class="text-muted">Unknown</span>{% endif %}</td>
          <td style="border:1px solid #ddd;padding:10px;">{{ sc.admission_year }}</td>
          <td style="border:1px solid #ddd;padding:10px;text-align:center;">
            {% if not show_deleted %}
              <a class="link-action" href="{% url 'academics:view_semester_credits_pdf' sc.pk %}">View</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:download_semester_credits_pdf' sc.pk %}">Download</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:edit_semester_credit' sc.pk %}">Edit</a>
              <span class="separator">|</span>
              <!-- Replace/delete link for semester credit -->
              <a class="link-action" href="{% url 'academics:delete_credit_pdf' sc.pk %}" onclick="return confirm('Move to recycle bin?');">Delete</a>
            {% else %}
              <a class="link-action" href="{% url 'academics:restore_credit_pdf' sc.pk %}">Restore</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:permanent_delete_credit_pdf' sc.pk %}" onclick="return confirm('Permanently delete?');">Delete Permanently</a>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="3" style="text-align:center;padding:20px;">No semester credit records.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- ========== GENERATED SYLLABI (actions aligned with others) ========== -->
  <h3>Generated Syllabi {% if not show_deleted %}(Active){% else %}(Recycle Bin){% endif %}</h3>
  <table style="width:100%;border-collapse:collapse;margin-bottom:20px;">
    <thead>
      <tr style="background:#f4f6f8;">
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Course</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Generated</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:left;">Semester</th>
        <th style="border:1px solid #ddd;padding:10px;text-align:center;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for s in syllabi %}
        <tr>
          <td style="border:1px solid #ddd;padding:10px;">
            {% if s.course %}
              <strong>{{ s.course.course_code }}</strong> — <span class="text-clip" title="{{ s.course.course_title }}">{{ s.course.course_title }}</span>
            {% else %}
              <span class="text-muted">(Orphan syllabus)</span>
            {% endif %}
          </td>
          <td style="border:1px solid #ddd;padding:10px;">{% if s.created_on %}{{ s.created_on|date:"d M Y, H:i" }}{% else %}-{% endif %}</td>
          <td style="border:1px solid #ddd;padding:10px;">{{ s.display_semester }}</td>
          <td style="border:1px solid #ddd;padding:10px;text-align:center;">
            {% if not show_deleted and s.course %}
              <a class="link-action" href="{% url 'academics:view_syllabus_pdf' s.pk %}">View</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:download_syllabus_pdf' s.pk %}">Download</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:add_or_edit_syllabus' s.course.pk %}">Edit</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:delete_syllabus' s.pk %}" onclick="return confirm('Move to recycle bin?');">Delete</a>
            {% elif not show_deleted %}
              <span class="text-muted">—</span>
            {% else %}
              <a class="link-action" href="{% url 'academics:restore_syllabus' s.pk %}">Restore</a>
              <span class="separator">|</span>
              <a class="link-action" href="{% url 'academics:permanent_delete_syllabus' s.pk %}" onclick="return confirm('Permanently delete?');">Delete Permanently</a>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="4" style="text-align:center;padding:20px;">No syllabi found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

</div>

{% endblock %}
